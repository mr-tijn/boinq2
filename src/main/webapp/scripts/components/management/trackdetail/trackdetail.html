<div>


	<a ui-sref="track({dsId:datasource.id})">
		<button class="btn btn-primary btn-sm">
			<span class="glyphicon glyphicon-fast-backward"></span> Track
			overview
		</button>
	</a>



	<div id="generic" class="panel panel-default">

		<div class="panel-heading">
			<h3>General info</h3>

		</div>

		<div class="panel-body">

			<form name="trackForm" role="form" novalidate
				class="ng-scope ng-invalid ng-invalid-required ng-dirty ng-valid-minlength"
				ng-submit="save()">

				<div class="form-group">
					<label>ID</label> <input type="text" class="form-control" name="id"
						ng-model="track.id" readonly>
				</div>

				<div class="form-group">
					<label>Name</label> <input type="text" class="form-control"
						name="trackName" ng-model="track.name" ng-minlength=1
						ng-maxlength=200>
				</div>

				<div class="form-group">
					<label>Description</label> 
					<textarea class="form-control" rows=4 ng-model="track.description"></textarea>
				</div>

				<div class="form-group" >
					<label>Type</label> <select name="type"
						ng-model="track.type" class="form-control">
						<option>generic</option>
						<option>feature</option>
					</select>
				</div>


				<div class="form-group">
					<label>Graph name</label> <input type="text" class="form-control"
						name="graphName" ng-model="track.graphName" ng-minlength=1
						ng-maxlength=200 ng-disabled="isLocal(datasource)">
				</div>

				<div class="form-group">
					<label>Entry Count</label> <input type="text" class="form-control"
						name="entryCount" ng-model="track.entryCount" readonly>
				</div>

				<div class="form-group" ng-show="track.type == 'feature'">
					<label>Feature Count</label> <input type="text"
						class="form-control" name="featureCount"
						ng-model="track.featureCount" readonly>
				</div>

				<div class="form-group">
					<label>Triple Count</label> <input type="text" class="form-control"
						name="tripleCount" ng-model="track.tripleCount" readonly>
				</div>

				<div class="form-group" ng-show="track.type == 'feature'">
					<label>Species</label> <select name="species"
						ng-model="track.species" class="form-control"
						ng-disabled="track.species"
						ng-change="getAssemblies(track.species)"
						ng-options="item.label as item.label for item in supportedSpecies">
						<option value=track.species>track.species</option>
					</select>
				</div>
				<div class="form-group" ng-show="track.type == 'feature'">
					<label>Assembly</label> <select name="assembly"
						ng-model="track.assembly" class="form-control"
						ng-disabled="track.assembly"
						ng-options="item.label as item.label for item in assemblyList">
						<option value="track.assembly">track.species</option>
					</select>
				</div>

				<div class="form-group" ng-show="track.type == 'feature'">
					<label>File Format</label> <select type="text" class="form-control"
						name="fileFormat" ng-model="track.fileType">
						<option>BED</option>
						<option>GFF</option>
						<option>VCF</option>
					</select>
				</div>

				<button type="submit" ng-disabled="trackForm.$invalid"
					class="btn btn-primary" ng-click="active=null">
					<span class="glyphicon glyphicon-save"></span> Save
				</button>
			</form>

		</div>
	</div>
	<!-- General info -->

	<div id="rawdata" class="panel panel-default"
		ng-if="track.fileType != null"
		ng-show="track.type == 'feature' && !iscomplete(track)">

		<div class="panel-heading">
			<h3>Raw data files</h3>
		</div>

		<div class="panel-body">

			<span width="50%" class="btn btn-primary btn-sm btn-file" onclick="document.querySelector('#local-file-upload').click()"> 
				<span class="glyphicon glyphicon-file"></span> Upload a file from your computer... <input
				type="file" id="local-file-upload" nv-file-select uploader="uploader" multiple style="display: none" >
			</span>

			<div class="btn btn-primary btn-sm"
				ng-click="addServerFile()">
				<span class="glyphicon glyphicon-file"></span> Add existing server file...
			</div>

			<table class="table">
				<thead>
					<tr>
						<th width="50%">Path</th>
						<th>Status</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="rawDataFile in track.rawDataFiles">
						<td>{{rawDataFile.filePath}}</td>
						<td>{{rawDataFile.status | dfstatus}}</td>
						<td>
							<div class="btn btn-danger btn-xs"
								ng-show="hasError(rawDataFile)"
								ng-click="showFileError(rawDataFile.errorMessage)">
								<span class="glyphicon glyphicon-warning-sign"></span> Show
								error
							</div>

							<div class="btn btn-danger btn-xs"
								ng-disabled="rawDataFile.status==DataFileConstants.STATUS_LOADING"
								ng-click="removefile(rawDataFile.id)">
								<span class="glyphicon glyphicon-trash"></span> Remove
							</div>

						</td>
					</tr>
				</tbody>
			</table>

			<h3 ng-show='uploader.queue.length'>Upload queue</h3>

			<table ng-show='uploader.queue.length' class="table">
				<thead>
					<tr>
						<th width="50%">Name</th>
						<th ng-show="uploader.isHTML5">Size</th>
						<th ng-show="uploader.isHTML5">Progress</th>
						<th>Status</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="item in uploader.queue">
						<td><strong>{{ item.file.name }}</strong></td>
						<td ng-show="uploader.isHTML5" nowrap>{{
							item.file.size/1024/1024|number:2 }} MB</td>
						<td ng-show="uploader.isHTML5">
							<div class="progress" style="margin-bottom: 0;">
								<div class="progress-bar" role="progressbar"
									ng-style="{ 'width': item.progress + '%' }"></div>
							</div>
						</td>
						<td class="text-center"><span ng-show="item.isSuccess"><i
								class="glyphicon glyphicon-ok"></i></span> <span
							ng-show="item.isCancel"><i
								class="glyphicon glyphicon-ban-circle"></i></span> <span
							ng-show="item.isError"><i
								class="glyphicon glyphicon-remove"></i></span></td>
						<td nowrap>
							<button type="button" class="btn btn-success btn-xs"
								ng-click="item.upload()"
								ng-disabled="item.isReady || item.isUploading || item.isSuccess">
								<span class="glyphicon glyphicon-upload"></span> Upload
							</button>
							<button type="button" class="btn btn-warning btn-xs"
								ng-click="item.cancel()" ng-disabled="!item.isUploading">
								<span class="glyphicon glyphicon-ban-circle"></span> Cancel
							</button>
							<button type="button" class="btn btn-danger btn-xs"
								ng-click="item.remove()">
								<span class="glyphicon glyphicon-trash"></span> Remove
							</button>
						</td>
					</tr>
				</tbody>
			</table>
			<div ng-show='uploader.queue.length'>
				<div>
					Queue progress:
					<div class="progress" style="">
						<div class="progress-bar" role="progressbar"
							ng-style="{ 'width': uploader.progress + '%' }"></div>
					</div>
				</div>
				<button type="button" class="btn btn-success btn-s"
					ng-click="uploader.uploadAll()"
					ng-disabled="!uploader.getNotUploadedItems().length">
					<span class="glyphicon glyphicon-upload"></span> Upload all
				</button>
				<button type="button" class="btn btn-warning btn-s"
					ng-click="uploader.cancelAll()" ng-disabled="!uploader.isUploading">
					<span class="glyphicon glyphicon-ban-circle"></span> Cancel all
				</button>
				<button type="button" class="btn btn-danger btn-s"
					ng-click="uploader.clearQueue()"
					ng-disabled="!uploader.queue.length">
					<span class="glyphicon glyphicon-trash"></span> Remove all
				</button>
			</div>
		</div>

	</div>
	<!-- raw data -->

	<div class="panel panel-default" ng-enabled="track.status<2" ng-show="track.type == 'feature' && !iscomplete(track)">

		<div class="panel-heading">
			<h3>Converter options {{track.fileType.toLowerCase()}}</h3>
		</div>

		<div class="panel-body">

			<form name="trackForm" role="form" novalidate
				class="ng-scope ng-invalid ng-invalid-required ng-dirty ng-valid-minlength">

				<div class="form-group">
					<label>Prefix Contig</label> <input type="text"
						class="form-control" name="contigPrefix"
						ng-model="track.contigPrefix" ng-minlength=1 ng-maxlength=200>
					<p>e.g. {{track.contigPrefix}}1 is mapped as
						{{getMapping()}}</p>
				</div>

				<div
					ng-show="track.fileType != null && track.fileType.toLowerCase()  == 'bed'">
					<hr>
					<h4 class="modal-title" id="myFeatureTypeLabel">
						<b>Feature Types Options</b>
					</h4>
					<hr>
					<div class="form-group">
						<label>Type of the features</label>
						<term-tree-picker modal-id="mainTypePicker"
							select-handler="mainTypePicker"
							source-endpoint="{{staticEndpoint}}"
							source-graph="http://purl.obolibrary.org/obo/so-xp.obo"
							search-filter="searchFilter" multi-valued='false'
							form-field-name="mainType" ng-model="mainType">
						</term-tree-picker>
					</div>
 					<div class="form-group" ng-show="terms.mainType!=null">
						<label>Type of the subfeature</label>
						<term-tree-picker ng-show="mainType!=null"
							modal-id="subTypePicker" select-handler="subTypePicker"
							source-endpoint="{{staticEndpoint}}"
							source-graph="http://purl.obolibrary.org/obo/so-xp.obo"
							search-filter="searchFilter" multi-valued='false'
							form-field-name="mainType" ng-model="subType">
						</term-tree-picker>
					</div>
 					<div class="form-group">
						<label>Type of the score attribute</label>
						<term-tree-picker
							modal-id="attributeTypePicker" select-handler="attributeTypePicker"
							source-endpoint="{{staticEndpoint}}"
							source-graph="http://purl.bioontology.org/ontology/SIO"
							search-filter="searchFilter" multi-valued='false'
							form-field-name="attributeType" ng-model="attributeType">
						</term-tree-picker>
					</div>
				</div>


				<button type="button"
					ng-disabled="track.assembly==null || track.species==null"
					class="btn btn-primary" ng-click="confirmconversion()">
					<span class="glyphicon glyphicon-save"></span>Start Conversion
				</button>

				<button type="button"
					ng-disabled="track.status < TrackConstants.STATUS_PROCESSING"
					class="btn btn-danger" ng-click="confirmempty()">
					<span class="glyphicon glyphicon-trash"></span>Empty Data
				</button>

			</form>
		</div>
	</div>
	<!-- conversion options -->

	<div class="panel panel-default" ng-if="track.type == 'feature' && iscomplete(track)">
		<div class="panel-heading">
			<h3>Graph template</h3>
		</div>

		<div class="panel-body">
			<graphtemplateview graph-template-id="track.graphTemplateId"></graphtemplateview>
		</div>

	</div>
	
	<a ui-sref="graphtemplate({id:track.graphTemplateId,trackId:track.id,datasourceId:datasource.id})" ng-show="track.type == 'generic'">
		<button class="btn btn-primary btn-sm">
			<span class="glyphicon glyphicon-pencil"></span> Edit template
		</button>
	</a>
	

</div>

<div class="modal fade ng-scope" ng-submit="startconversion()"
	id="confirmConversion" tabindex="-1" role="dialog"
	aria-labelledby="myTrackLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Confirm conversion</h4>
			</div>
			<div class="modal-body">Warning: if you continue, you will not
				be able to add any more raw data files, or alter the feature types.
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal"
					ng-click="clear()">
					<span class="glyphicon glyphicon-ban-circle"></span> Close
				</button>
				<button type="button" class="btn btn-default" data-dismiss="modal"
					aria-hidden="true" ng-click="startconversion()">Confirm</button>
			</div>
		</div>
	</div>
</div>

<div class="modal fade ng-scope" ng-submit="startempty()"
	id="confirmEmpty" tabindex="-1" role="dialog"
	aria-labelledby="myTrackLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Confirm empty</h4>
			</div>
			<div class="modal-body">Are you sure you want to empty all data
				of this track ?</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal"
					ng-click="clear()">
					<span class="glyphicon glyphicon-ban-circle"></span> Close
				</button>
				<button type="button" class="btn btn-default" data-dismiss="modal"
					aria-hidden="true" ng-click="startempty()">Confirm</button>
			</div>
		</div>
	</div>
</div>

<div class="modal fade ng-scope" id="fileError" tabindex="-1"
	role="dialog" aria-labelledby="myTrackLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Error message</h4>
			</div>
			<div class="modal-body">{{fileError}}</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal"
					ng-click="clear()">
					<span class="glyphicon glyphicon-ban-circle"></span> Close
				</button>
			</div>
		</div>
	</div>
</div>

<div class="modal fade ng-scope" id="addServerFile" tabindex="-1"
	role="dialog" aria-labelledby="addServerFileLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Add file path</h4>
			</div>
			<div class="modal-body">
				<form>
				
					<div class="form-group">
						<label>Server file path</label> <input type="text" class="form-control"
						name="tripleCount" ng-model="newServerFilePath">
					</div>

					<button type="submit" 
						class="btn btn-primary" ng-click="saveServerFile()">
						<span class="glyphicon glyphicon-save"></span> Save
					</button>
				
				</form>
			
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					<span class="glyphicon glyphicon-ban-circle"></span> Close
				</button>
			</div>
		</div>
	</div>
</div>


</div>